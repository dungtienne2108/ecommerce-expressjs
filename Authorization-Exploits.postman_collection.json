{
  "info": {
    "name": "Ecommerce - Authorization Exploits Demo",
    "description": "Collection ƒë·ªÉ demo c√°c l·ªó h·ªïng ph√¢n quy·ªÅn v√† exploitation scenarios",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "attackerToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "customerToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "sellerToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "shopId",
      "value": "",
      "type": "string"
    },
    {
      "key": "victimUserId",
      "value": "",
      "type": "string"
    },
    {
      "key": "victimOrderId",
      "value": "",
      "type": "string"
    },
    {
      "key": "victimConversationId",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Setup - Authentication",
      "item": [
        {
          "name": "Login as Attacker",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('attackerToken', response.data.accessToken);",
                  "    console.log('‚úÖ Attacker token saved');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"attacker@example.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "Login as Customer",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('customerToken', response.data.accessToken);",
                  "    console.log('‚úÖ Customer token saved');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"customer@example.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "Login as Seller",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('sellerToken', response.data.accessToken);",
                  "    console.log('‚úÖ Seller token saved');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"seller@example.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "Register New Attacker Account",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    console.log('‚úÖ Registration successful');",
                  "    console.log('‚ÑπÔ∏è  Now login with this account');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"attacker-{{$timestamp}}@example.com\",\n  \"password\": \"Hacker123!\",\n  \"fullName\": \"Attacker User\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            }
          }
        }
      ]
    },
    {
      "name": "üî¥ EXPLOIT #1: Shop Self-Approval",
      "item": [
        {
          "name": "Step 1: Create Shop",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('shopId', response.data.id);",
                  "    console.log('‚úÖ Shop created:', response.data.id);",
                  "    console.log('Status:', response.data.status);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{attackerToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Fake Shop {{$timestamp}}\",\n  \"description\": \"This is a malicious shop for testing\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/shops",
              "host": ["{{baseUrl}}"],
              "path": ["api", "shops"]
            }
          }
        },
        {
          "name": "Step 2: Submit KYC",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{attackerToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"businessLicense\": \"https://fake-url.com/license.pdf\",\n  \"identityCard\": \"https://fake-url.com/id.jpg\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/shops/{{shopId}}/kyc",
              "host": ["{{baseUrl}}"],
              "path": ["api", "shops", "{{shopId}}", "kyc"]
            }
          }
        },
        {
          "name": "Step 3: Submit for Approval",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{attackerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/shops/{{shopId}}/submit-approval",
              "host": ["{{baseUrl}}"],
              "path": ["api", "shops", "{{shopId}}", "submit-approval"]
            }
          }
        },
        {
          "name": "üö® Step 4: EXPLOIT - Self Approve",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('üî¥ VULNERABILITY CONFIRMED!');",
                  "    console.log('‚ùå Shop was self-approved by attacker');",
                  "    console.log('‚ö†Ô∏è  This should require KYC_REVIEWER or SYSTEM_ADMIN role');",
                  "    pm.test('üî¥ CRITICAL: Shop Self-Approval Vulnerability', function() {",
                  "        pm.expect(pm.response.code).to.equal(403);",
                  "    });",
                  "} else if (pm.response.code === 403) {",
                  "    console.log('‚úÖ SECURITY OK: Self-approval was blocked');",
                  "    pm.test('‚úÖ Security working correctly', function() {",
                  "        pm.expect(pm.response.code).to.equal(403);",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{attackerToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"note\": \"I approve myself! This is a security vulnerability.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/shops/{{shopId}}/approval",
              "host": ["{{baseUrl}}"],
              "path": ["api", "shops", "{{shopId}}", "approval"]
            }
          }
        }
      ]
    },
    {
      "name": "üî¥ EXPLOIT #2: Approve Other's Shop",
      "item": [
        {
          "name": "üö® EXPLOIT - Customer Approves Seller's Shop",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('üî¥ VULNERABILITY CONFIRMED!');",
                  "    console.log('‚ùå Customer can approve other seller\\'s shop');",
                  "    pm.test('üî¥ CRITICAL: Unauthorized Shop Approval', function() {",
                  "        pm.expect(pm.response.code).to.equal(403);",
                  "    });",
                  "} else if (pm.response.code === 403) {",
                  "    console.log('‚úÖ SECURITY OK: Unauthorized approval blocked');",
                  "    pm.test('‚úÖ Security working correctly', function() {",
                  "        pm.expect(pm.response.code).to.equal(403);",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}",
                "description": "Using CUSTOMER token to approve SELLER's shop"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"note\": \"Unauthorized approval by customer\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/shops/{{shopId}}/approval",
              "host": ["{{baseUrl}}"],
              "path": ["api", "shops", "{{shopId}}", "approval"]
            }
          }
        },
        {
          "name": "üö® EXPLOIT - Reject Competitor's Shop",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('üî¥ VULNERABILITY: Can reject competitor shop');",
                  "} else if (pm.response.code === 403) {",
                  "    console.log('‚úÖ SECURITY OK: Rejection blocked');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{sellerToken}}",
                "description": "Seller A trying to reject Seller B's shop"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"Malicious rejection by competitor\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/shops/{{shopId}}/reject",
              "host": ["{{baseUrl}}"],
              "path": ["api", "shops", "{{shopId}}", "reject"]
            }
          }
        }
      ]
    },
    {
      "name": "üî¥ EXPLOIT #3: User Info IDOR",
      "item": [
        {
          "name": "Get My Own Info (Baseline)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    console.log('My ID:', response.data.id);",
                  "    console.log('My Email:', response.data.email);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{attackerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "me"]
            }
          }
        },
        {
          "name": "üö® EXPLOIT - View Victim's User Info",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('üî¥ IDOR VULNERABILITY CONFIRMED!');",
                  "    const response = pm.response.json();",
                  "    console.log('‚ùå Leaked Email:', response.data.email);",
                  "    console.log('‚ùå Leaked Phone:', response.data.phone);",
                  "    console.log('‚ùå Account Status:', response.data.status);",
                  "    pm.test('üî¥ HIGH: IDOR Vulnerability - Can view other users', function() {",
                  "        pm.expect(pm.response.code).to.equal(403);",
                  "    });",
                  "} else if (pm.response.code === 403) {",
                  "    console.log('‚úÖ SECURITY OK: Access to other user denied');",
                  "    pm.test('‚úÖ Security working correctly', function() {",
                  "        pm.expect(pm.response.code).to.equal(403);",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{attackerToken}}",
                "description": "Attacker trying to view victim's info"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/{{victimUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "{{victimUserId}}"],
              "variable": [
                {
                  "key": "victimUserId",
                  "description": "Set this to victim's user ID"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üü° EXPLOIT #4: Order Status Update",
      "item": [
        {
          "name": "üö® EXPLOIT - Cancel Someone Else's Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('üî¥ VULNERABILITY: Can modify other\\'s order');",
                  "    pm.test('üü° MEDIUM: Unauthorized Order Modification', function() {",
                  "        pm.expect(pm.response.code).to.equal(403);",
                  "    });",
                  "} else if (pm.response.code === 403 || pm.response.code === 404) {",
                  "    console.log('‚úÖ SECURITY OK: Order modification blocked');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{attackerToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"CANCELLED\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/orders/{{victimOrderId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["api", "orders", "{{victimOrderId}}", "status"]
            }
          }
        },
        {
          "name": "üö® EXPLOIT - Mark as Delivered (Fraud)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('üî¥ VULNERABILITY: Can mark order as delivered');",
                  "    console.log('‚ö†Ô∏è  Impact: Fraud - claim delivery without shipping');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{attackerToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"DELIVERED\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/orders/{{victimOrderId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["api", "orders", "{{victimOrderId}}", "status"]
            }
          }
        }
      ]
    },
    {
      "name": "üü° EXPLOIT #5: Chat Privacy Breach",
      "item": [
        {
          "name": "üö® EXPLOIT - Read Other's Conversation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('üî¥ PRIVACY BREACH!');",
                  "    const response = pm.response.json();",
                  "    console.log('‚ùå Can read conversation messages');",
                  "    console.log('Messages count:', response.data.length);",
                  "    pm.test('üü° MEDIUM: Chat Privacy Breach', function() {",
                  "        pm.expect(pm.response.code).to.equal(403);",
                  "    });",
                  "} else if (pm.response.code === 403) {",
                  "    console.log('‚úÖ SECURITY OK: Conversation access blocked');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{attackerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/chat/conversations/{{victimConversationId}}/messages",
              "host": ["{{baseUrl}}"],
              "path": ["api", "chat", "conversations", "{{victimConversationId}}", "messages"]
            }
          }
        },
        {
          "name": "üö® EXPLOIT - Send Fake Message",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    console.log('üî¥ VULNERABILITY: Can send message to other\\'s conversation');",
                  "    console.log('‚ö†Ô∏è  Impact: Phishing, impersonation');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{attackerToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"content\": \"[FAKE ADMIN MESSAGE] Please transfer money to account: 1234567890\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/chat/conversations/{{victimConversationId}}/messages",
              "host": ["{{baseUrl}}"],
              "path": ["api", "chat", "conversations", "{{victimConversationId}}", "messages"]
            }
          }
        },
        {
          "name": "üö® EXPLOIT - Delete Other's Message",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{attackerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/chat/messages/:messageId",
              "host": ["{{baseUrl}}"],
              "path": ["api", "chat", "messages", ":messageId"],
              "variable": [
                {
                  "key": "messageId",
                  "value": ""
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "‚úÖ Valid Authorization Tests",
      "item": [
        {
          "name": "‚úÖ Admin Can List All Users",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Admin access should succeed', function() {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users"]
            }
          }
        },
        {
          "name": "‚úÖ Customer Cannot List Users",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Customer should be denied', function() {",
                  "    pm.expect(pm.response.code).to.equal(403);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users"]
            }
          }
        },
        {
          "name": "‚úÖ Seller Can Create Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Seller with permission should succeed', function() {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{sellerToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"iPhone 15 Pro Max\",\n  \"description\": \"Latest iPhone model\",\n  \"shopId\": \"{{shopId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/products",
              "host": ["{{baseUrl}}"],
              "path": ["api", "products"]
            }
          }
        },
        {
          "name": "‚úÖ Customer Cannot Create Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Customer should be denied', function() {",
                  "    pm.expect(pm.response.code).to.equal(403);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Fake Product\",\n  \"shopId\": \"{{shopId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/products",
              "host": ["{{baseUrl}}"],
              "path": ["api", "products"]
            }
          }
        }
      ]
    }
  ]
}
